(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{4018:function(e,t,r){Promise.resolve().then(r.bind(r,1729)),Promise.resolve().then(r.bind(r,5370))},1729:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(7437),a=r(2265);let o="http://localhost:8000";async function i(){return(await fetch("".concat(o,"/api/health"),{credentials:"omit"})).json()}async function n(e){let t="".concat(o,"/api/analysis/result?analysis_id=").concat(encodeURIComponent(e)),r=await fetch(t);if(!r.ok)throw Error("getAnalysisResult failed: ".concat(r.status));return r.json()}var l=r(2430),d=r(9006),c=r(9625),u=r(6885);let h={theme:"system",language:"en",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,dateFormat:"MM/DD/YYYY",timeFormat:"12h",notifications:{email:!0,push:!0,analysis:!0,alerts:!0},accessibility:{highContrast:!1,reducedMotion:!1,fontSize:"medium"}},p=(0,c.Ue)()((0,u.mW)((0,u.tJ)((e,t)=>({layout:{sidebarOpen:!1,headerHeight:64,footerHeight:48},sidebarOpen:!1,sidebarCollapsed:!1,headerHeight:64,footerHeight:48,theme:"dark",systemTheme:"light",actualTheme:"dark",viewport:{width:window.innerWidth,height:window.innerHeight,isMobile:!1,isTablet:!1,isDesktop:!0},preferences:h,notifications:[],unreadCount:0,modals:[],toasts:[],globalLoading:!1,loadingStates:{},loading:{},globalError:null,errorStates:{},errors:{},currentStep:1,totalSteps:1,progress:0,setSidebarOpen:t=>e(e=>({sidebarOpen:t,layout:{...e.layout,sidebarOpen:t}})),toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen,layout:{...e.layout,sidebarOpen:!e.sidebarOpen}})),setSidebarCollapsed:t=>e({sidebarCollapsed:t}),setHeaderHeight:t=>e({headerHeight:t}),setFooterHeight:t=>e({footerHeight:t}),setTheme:r=>{let s=t(),a="system"===r?s.systemTheme:r;e({theme:r,actualTheme:a})},toggleTheme:()=>{let r="light"===t().actualTheme?"dark":"light";e({theme:r,actualTheme:r})},setSystemTheme:r=>{let s=t(),a="system"===s.theme?r:s.actualTheme;e({systemTheme:r,actualTheme:a})},setViewport:t=>e({viewport:t}),updateViewport:t=>e(e=>({viewport:{...e.viewport,...t}})),setPreferences:t=>e(e=>{let r={...e.preferences,...t};return void 0!==t.theme&&delete r.theme,{preferences:r}}),resetPreferences:()=>e({preferences:h}),addNotification:t=>{let r="notification_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),s={...t,id:r,created_at:new Date().toISOString(),read:!1};e(e=>({notifications:[s,...e.notifications],unreadCount:e.unreadCount+1}))},removeNotification:t=>e(e=>{let r=e.notifications.find(e=>e.id===t),s=r&&!r.read;return{notifications:e.notifications.filter(e=>e.id!==t),unreadCount:s?e.unreadCount-1:e.unreadCount}}),markNotificationRead:t=>e(e=>{let r=e.notifications.find(e=>e.id===t);return r&&!r.read?{notifications:e.notifications.map(e=>e.id===t?{...e,read:!0}:e),unreadCount:e.unreadCount-1}:e}),markAllNotificationsRead:()=>e(e=>({notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0})),clearNotifications:()=>e({notifications:[],unreadCount:0}),openModal:t=>{let r="modal_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),s={...t,id:r};return e(e=>({modals:[...e.modals,s]})),r},closeModal:t=>e(e=>({modals:e.modals.filter(e=>e.id!==t)})),closeAllModals:()=>e({modals:[]}),addToast:r=>{let s="toast_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),a={...r,id:s};return e(e=>({toasts:[...e.toasts,a]})),r.duration>0&&setTimeout(()=>{t().removeToast(s)},r.duration),s},removeToast:t=>e(e=>({toasts:e.toasts.filter(e=>e.id!==t)})),clearToasts:()=>e({toasts:[]}),setGlobalLoading:t=>e({globalLoading:t}),setLoading:(t,r)=>e(e=>({loadingStates:{...e.loadingStates,[t]:r},loading:{...e.loading,[t]:r}})),isLoading:e=>{let r=t();return e?r.loadingStates[e]||!1:r.globalLoading||Object.values(r.loadingStates).some(e=>e)},setGlobalError:t=>e({globalError:t}),setError:(t,r)=>e(e=>({errorStates:{...e.errorStates,[t]:r},errors:{...e.errors,[t]:r}})),clearError:t=>{t?e(e=>({errorStates:{...e.errorStates,[t]:null},errors:{...e.errors,[t]:null}})):e({globalError:null,errorStates:{},errors:{}})},clearLoading:t=>e(e=>({loadingStates:{...e.loadingStates,[t]:!1},loading:{...e.loading,[t]:!1}})),clearAllErrors:()=>e({globalError:null,errorStates:{},errors:{}}),setCurrentStep:r=>{let s=t(),a=s.totalSteps>0?r/s.totalSteps*100:0;e({currentStep:r,progress:a})},setTotalSteps:r=>{let s=t(),a=r>0?s.currentStep/r*100:0;e({totalSteps:r,progress:a})},nextStep:()=>{let e=t();e.currentStep<e.totalSteps&&t().setCurrentStep(e.currentStep+1)},prevStep:()=>{let e=t();e.currentStep>1&&t().setCurrentStep(e.currentStep-1)},resetSteps:()=>e({currentStep:1,totalSteps:1,progress:0}),updateLayout:t=>e(e=>({layout:{...e.layout,...t}})),updatePreferences:t=>e(e=>({preferences:{...e.preferences,...t}})),showToast:e=>t().addToast(e),hideToast:e=>{t().removeToast(e)},clearAllLoading:()=>e({globalLoading:!1,loadingStates:{},loading:{}}),hasError:e=>{let r=t();return!!(r.errorStates[e]||r.globalError)},getError:e=>{let r=t();return r.errorStates[e]||r.globalError},isMobile:()=>t().viewport.isMobile,isTablet:()=>t().viewport.isTablet,isDesktop:()=>t().viewport.isDesktop,getResponsiveValue:e=>{let r=t();return r.viewport.isMobile?e.mobile:r.viewport.isTablet?e.tablet:e.desktop},resetUI:()=>e({layout:{sidebarOpen:!1,headerHeight:64,footerHeight:48},sidebarOpen:!1,sidebarCollapsed:!1,headerHeight:64,footerHeight:48,theme:"dark",systemTheme:"light",actualTheme:"dark",viewport:{width:window.innerWidth,height:window.innerHeight,isMobile:!1,isTablet:!1,isDesktop:!0},preferences:h,notifications:[],unreadCount:0,modals:[],toasts:[],globalLoading:!1,loadingStates:{},loading:{},globalError:null,errorStates:{},errors:{},currentStep:1,totalSteps:1,progress:0})}),{name:"ui-store",partialize:e=>({theme:e.theme,preferences:e.preferences,sidebarCollapsed:e.sidebarCollapsed})}),{name:"ui-store"}));function g(){let[e,t]=a.useState("idle"),[r,c]=a.useState([]),[u,h]=a.useState(null),g=a.useRef(null),m=(0,l._)(),S=(0,d.V)(),b=p();function f(e){c(t=>[new Date().toLocaleTimeString()+" â€” "+e,...t].slice(0,200))}async function y(){t("pinging");try{let e=await i();f("health: "+JSON.stringify(e)),t("ok")}catch(e){f("health ERROR: "+((null==e?void 0:e.message)||String(e))),t("error")}}async function x(){try{let e={biomarkers:{cholesterol:{value:4.9,unit:"mmol/L"},blood_sugar:{value:4.8,unit:"mmol/L"}},user:{age:58,sex:"male"}};f("Starting analysis with payload: "+JSON.stringify(e)),await m.startAnalysis(e),b.addToast({type:"info",title:"Analysis Started",message:"Biomarker analysis has been initiated",duration:3e3,position:"top-right"});let t=m.currentAnalysis;t&&(h(t.analysis_id),f("Analysis started with ID: "+t.analysis_id))}catch(e){f("startAnalysis ERROR: "+((null==e?void 0:e.message)||String(e))),u&&m.failAnalysis(u,{message:(null==e?void 0:e.message)||String(e),code:"ANALYSIS_START_ERROR"}),b.addToast({type:"error",title:"Analysis Failed",message:"Failed to start biomarker analysis",duration:5e3,position:"top-right"})}}async function v(){if(!u){f("No analysisId yet");return}try{let e=await n(u);f("result: "+JSON.stringify(e))}catch(e){f("getAnalysisResult ERROR: "+((null==e?void 0:e.message)||String(e)))}}return a.useEffect(()=>()=>{g.current&&g.current.close()},[]),(0,s.jsxs)("div",{style:{position:"fixed",right:16,bottom:16,zIndex:9999,maxWidth:500},className:"rounded-xl border p-3 shadow bg-white/90 backdrop-blur",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,s.jsx)("strong",{children:"Dev API Probe + Store State"}),(0,s.jsxs)("span",{style:{fontSize:12,opacity:.7},children:["status: ",e]})]}),(0,s.jsxs)("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:[(0,s.jsx)("div",{className:"font-semibold mb-1",children:"Store States:"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Analysis:"})," ",m.currentPhase," (",m.progress,"%)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Clusters:"})," ",S.clusters.length," loaded"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"UI:"})," ",b.toasts.length," toasts, ",b.notifications.length," notifications"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Theme:"})," ",b.actualTheme]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2 flex-wrap",children:[(0,s.jsx)("button",{onClick:y,className:"px-3 py-1 rounded bg-black text-white text-xs",children:"Ping API"}),(0,s.jsx)("button",{onClick:function(){var e;g.current&&g.current.close();let t=(e="demo",new EventSource("".concat(o,"/api/analysis/events?analysis_id=").concat(encodeURIComponent(e))));g.current=t,t.onopen=()=>f("[SSE] open"),t.onerror=e=>f("[SSE] error"),t.addEventListener("analysis_status",e=>{try{var r,s,a;let o=JSON.parse(e.data);f("[SSE] "+o.phase+" "+(null!==(a=null===(s=o.progress)||void 0===s?void 0:null===(r=s.toFixed)||void 0===r?void 0:r.call(s,2))&&void 0!==a?a:"")),"complete"===o.phase&&(t.close(),f("[SSE] closed (complete)"))}catch(e){f("[SSE] parse error")}})},className:"px-3 py-1 rounded bg-blue-600 text-white text-xs",children:"Start SSE"}),(0,s.jsx)("button",{onClick:function(){g.current&&(g.current.close(),g.current=null,f("[SSE] closed (manual)"))},className:"px-3 py-1 rounded bg-gray-200 text-xs",children:"Stop"}),(0,s.jsx)("button",{onClick:x,className:"px-3 py-1 rounded bg-green-600 text-white text-xs",children:"Start Analysis"}),(0,s.jsx)("button",{onClick:v,className:"px-3 py-1 rounded bg-purple-600 text-white text-xs",disabled:!u,children:"Fetch Result"}),(0,s.jsx)("button",{onClick:()=>b.toggleTheme(),className:"px-3 py-1 rounded bg-indigo-600 text-white text-xs",children:"Toggle Theme"}),(0,s.jsx)("button",{onClick:()=>S.loadClusters("demo"),className:"px-3 py-1 rounded bg-orange-600 text-white text-xs",children:"Load Clusters"})]}),(0,s.jsx)("div",{style:{maxHeight:200,overflow:"auto",fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace",fontSize:12,lineHeight:1.4},children:0===r.length?(0,s.jsx)("div",{style:{opacity:.6},children:"No logs yetâ€¦"}):r.map((e,t)=>(0,s.jsx)("div",{children:e},t))}),(0,s.jsxs)("div",{style:{fontSize:11,opacity:.6,marginTop:6},children:["Using API_BASE: ",(0,s.jsx)("code",{children:"http://localhost:8000"})]})]})}}},function(e){e.O(0,[566,116,860,971,117,744],function(){return e(e.s=4018)}),_N_E=e.O()}]);